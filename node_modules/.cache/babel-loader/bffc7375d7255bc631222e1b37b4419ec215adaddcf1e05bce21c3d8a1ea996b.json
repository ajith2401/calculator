{"ast":null,"code":"/*global require module console*/\n(function () {\n  \"use strict\";\n\n  var fs = require('fs'),\n    qs = require('querystring'),\n    url = require('url'),\n    sys = require('util'),\n    path = require('path'),\n    mime = require('mime'),\n    core = require('cornerstone'),\n    util = core.require('util'),\n    Model = require('./Model'),\n    Router = core.require('Router'),\n    Emitter = core.require('Emitter'),\n    connect = require('connect'),\n    mongoose = require('mongoose'),\n    Controller = require('./Controller');\n  function App() {\n    return this.initApp();\n  }\n  util.inherits(App, Emitter);\n  var app = App.prototype;\n  App.check = function (obj) {\n    return Emitter.check(obj) && obj.initApp === App.prototype.initApp;\n  };\n  App.create = function (obj, args) {\n    obj = obj || {};\n    if (!Emitter.check(obj)) Emitter.create(obj);\n    obj.initApp = app.initApp || function () {\n      this.initEmitter();\n      this.options = Object.create(this.options);\n      this.helpers = {};\n      this.router = new Router();\n      this.cache = Object.create(this.cache);\n      this.model = {};\n      return this;\n    };\n    obj.options = {\n      log: true,\n      root: null,\n      port: 1337,\n      host: '127.0.0.1',\n      maxAge: 86400000,\n      dbhost: '127.0.0.1',\n      dbport: '27017',\n      dbname: 'test',\n      hotCode: true,\n      watchInterval: 500,\n      sessionSecret: 'nosecret',\n      requestLimit: '50mb'\n    };\n    obj.cache = {};\n    (function () {\n      var appClient = require('app-client'),\n        clientSrc = appClient(),\n        modified = new Date(),\n        utils = connect.utils;\n      obj.cache['/app/client.js'] = function (req, res, next) {\n        var head = req.method === 'HEAD',\n          src = clientSrc;\n        if (req.method !== 'GET' && !head) return next();\n        res.setHeader('Content-Type', 'text/javascript; charset=UTF-8');\n        res.setHeader('Content-Length', src.length);\n        res.setHeader('Vary', 'Accept-Encoding');\n        res.setHeader('Cache-Control', 'public, max-age=86400');\n        res.setHeader('Last-Modified', modified.toUTCString());\n        res.setHeader('ETag', '\"' + src.length + '-' + modified.getTime() + '\"');\n        if (utils.conditionalGET(req) && !utils.modified(req, res)) {\n          utils.notModified(res);\n        } else if (head) res.end();else {\n          res.writeHead(200);\n          res.end(src, 'utf8');\n        }\n        return null;\n      };\n    })();\n    obj.config = function (opts) {\n      util.assign(this.options, opts);\n      return this;\n    };\n    obj.setup = function () {\n      var log = this.options.log,\n        root = this.options.root,\n        maxAge = this.options.maxAge,\n        publc = path.join(root, 'public');\n      this.log('Setup application server.');\n      this.server = connect.createServer();\n      if (log) this.server.use(connect.profiler()).use(connect.logger());\n      this.server.use(connect.limit(this.options.requestLimit)).use(connect.bodyParser()).use(connect.cookieParser()).use(connect.session({\n        secret: this.options.sessionSecret\n      })).use(connect.favicon(path.join(publc, 'favicon.ico'))).use( /*'/client', */connect['static'](path.join(root, 'client', {\n        maxAge: maxAge\n      }))).use(this.onRequest()).use(connect['static'](publc, {\n        maxAge: maxAge\n      })).use(this.respond404());\n      if (log) this.server.use(connect.responseTime());\n      this.log('Application server ready.');\n      return this.forever('setup server');\n    };\n    obj.connectDB = function () {\n      if (this.db) return this;\n      this.db = mongoose.connect(this.options.dbhost, this.options.dbname, this.options.dbport);\n      return this;\n    };\n    obj.log = function () {\n      if (this.options.log) console.log.apply(console, arguments);\n      return this;\n    };\n    obj.listen = function (cb) {\n      var that = this,\n        port = this.options.port,\n        host = this.options.host;\n      this.log('Building and caching http://' + host + ':' + port + '.');\n      return this.buildModel(function () {\n        that.buildApp(function () {\n          that.log('Listening http://' + host + ':' + port + '.');\n          that.server.listen(port, host, function () {\n            that.watchHotCode().buildClient(function () {\n              that.log('Finished http://' + host + ':' + port + '.');\n              cb.call(that);\n            });\n          });\n        });\n      });\n    };\n    obj.close = function () {\n      this.server.close();\n      if (this.options.hotCode) {\n        this.unwatchHotCode();\n      }\n      return this;\n    };\n    obj.routes = function (routes) {\n      this.router.def(routes);\n      return this;\n    };\n    obj.onRequest = function () {\n      var that = this;\n      return function (req, res, next) {\n        var uri = url.parse(req.url),\n          pth = uri.pathname,\n          route;\n        if (that.cache[pth]) {\n          that.log('app cache - ' + pth);\n          that.cache[pth].call(that, req, res, next);\n        } else {\n          route = that.router.get(pth);\n          if (route && route['']) {\n            that.log('app route - ' + pth);\n            that.router.send(route, function (r, info) {\n              req.routeInfo = info;\n              req.query = qs.parse(uri.query);\n              req.app = res.app = that;\n              r.call(that, req, res, next);\n            }, that);\n          } else next();\n        }\n      };\n    };\n    obj.respond404 = function () {\n      var that = this;\n      return function (req, res, next) {\n        if (util.isFunction(that.custom404)) {\n          that.custom404(req, res, next);\n        } else {\n          res.writeHead(404, {\n            'Content-Type': 'text/plain'\n          });\n          res.end('404');\n        }\n      };\n    };\n    obj.buildModel = function (cb) {\n      this.log('Building models.');\n      var that = this;\n      return this.scanFiles(path.join(this.options.root, 'model'), 1, function (dir, file, stats, end) {\n        if (file && stats.ext === 'js') {\n          var modelName = path.basename(file, '.js');\n          that.model[modelName] = require(file)(that);\n        }\n        end();\n      }, function () {\n        that.log('Finished building models.');\n        this.connectDB();\n        cb.apply(this, arguments);\n        that.forever('setup models');\n      });\n    };\n    obj.buildApp = function (cb) {\n      this.log('Building app.');\n      var that = this;\n      this.on('setup models', function () {\n        /*\n        that.io.sockets.on('connection', function (socket) {\n        \tthat.socket = socket;\n        \tthat.forever('socket ready', socket);\n        });\n        */\n        that.scanFiles(path.join(this.options.root, 'app'), 1, function (dir, file, stats, end) {\n          if (file && stats.ext === 'js') {\n            var helperName = path.basename(file, '.js');\n            that.helpers[helperName] = require(file)(that);\n          }\n          end();\n        }, function () {\n          that.log('Finished building app.');\n          cb.apply(this, arguments);\n          that.emit('setup app');\n        });\n      });\n      return this;\n    };\n    obj.buildClient = function (cb) {\n      cb.call(this);\n      return this;\n    };\n    obj.buildTest = function (cb) {\n      cb.call(this);\n      return this;\n    };\n    obj.watchHotCode = function () {\n      if (!this.options.hotCode) return this;\n      var that = this,\n        opts = {\n          interval: this.options.watchInterval\n        };\n      this.log('Creating model hot code watchers.').scanFiles(path.join(this.options.root, 'model'), 1, function (dir, file, stats, end) {\n        if (file && stats.ext === 'js') {\n          var modelName = path.basename(file, '.js');\n          fs.watchFile(file, opts, function (curr, prev) {\n            if (curr.mtime > prev.mtime) {\n              delete require.cache[require.resolve(file)];\n              that.model[modelName] = require(file)(that);\n            }\n          });\n        }\n        end();\n      }, function () {\n        that.log('Finished creating model hot code watchers.');\n      });\n      this.log('Creating app hot code watchers.').scanFiles(path.join(this.options.root, 'app'), 1, function (dir, file, stats, end) {\n        if (file && stats.ext === 'js') {\n          var helperName = path.basename(file, '.js');\n          fs.watchFile(file, opts, function (curr, prev) {\n            if (curr.mtime > prev.mtime) {\n              delete require.cache[require.resolve(file)];\n              that.helpers[helperName] = require(file)(that);\n            }\n          });\n        }\n        end();\n      }, function () {\n        that.log('Finished creating app hot code watchers.');\n      });\n      return this;\n    };\n    obj.unwatchHotCode = function (cb) {\n      if (!this.options.hotCode) return this;\n      var that = this;\n      function unwatch(dir, file, stats, end) {\n        if (file && stats.ext === 'js') {\n          fs.unwatchFile(file);\n        }\n        end();\n      }\n      this.scanFiles(path.join(this.options.root, 'model'), 1, unwatch, cb);\n      this.scanFiles(path.join(this.options.root, 'app'), 1, unwatch, cb);\n      return this;\n    };\n    obj.scanFiles = function (dir, depth, fn, cb, _mem) {\n      var that = this;\n      if (typeof fn !== 'function') return this;\n      if (!_mem) _mem = {\n        count: 1\n      };\n      if (!_mem.end) _mem.end = function end() {\n        _mem.count -= 1;\n        if (_mem.count <= 0 && !_mem.called) {\n          _mem.called = true;\n          cb.call(that);\n        }\n      };\n      fs.readdir(dir, function (err, files) {\n        if (err) throw err;\n        if (files.length === 0) {\n          return _mem.end();\n        }\n        var i = 0,\n          end = files.length,\n          last = files[end - 1];\n        function iterate(name) {\n          var file = path.join(dir, name);\n          fs.stat(file, function (err, stats) {\n            if (err) throw err;\n            function finish() {\n              _mem.end();\n              if (name === last) {\n                _mem.end();\n              }\n            }\n            if (stats.isDirectory() && depth > 0) {\n              _mem.count += 1;\n              fn.call(that, file, null, stats, function () {\n                that.scanFiles(file, depth - 1, fn, null, _mem);\n                if (name === last) {\n                  _mem.end();\n                }\n              });\n            } else if (stats.isFile()) {\n              _mem.count += 1;\n              stats.ext = path.extname(file).substr(1);\n              stats.encoding = mime.lookup(file);\n              stats.charset = mime.charsets.lookup(stats.encoding);\n              fn.call(that, dir, file, stats, finish);\n            } else {\n              finish();\n            }\n          });\n        }\n        for (; i < end; i += 1) iterate(files[i]);\n        return null;\n      });\n      return this;\n    };\n    if (args) obj.initApp.apply(obj, args);\n    return obj;\n  };\n  (module.exports = App).create(App.prototype);\n}).call(this);","map":{"version":3,"names":["fs","require","qs","url","sys","path","mime","core","util","Model","Router","Emitter","connect","mongoose","Controller","App","initApp","inherits","app","prototype","check","obj","create","args","initEmitter","options","Object","helpers","router","cache","model","log","root","port","host","maxAge","dbhost","dbport","dbname","hotCode","watchInterval","sessionSecret","requestLimit","appClient","clientSrc","modified","Date","utils","req","res","next","head","method","src","setHeader","length","toUTCString","getTime","conditionalGET","notModified","end","writeHead","config","opts","assign","setup","publc","join","server","createServer","use","profiler","logger","limit","bodyParser","cookieParser","session","secret","favicon","onRequest","respond404","responseTime","forever","connectDB","db","console","apply","arguments","listen","cb","that","buildModel","buildApp","watchHotCode","buildClient","call","close","unwatchHotCode","routes","def","uri","parse","pth","pathname","route","get","send","r","info","routeInfo","query","isFunction","custom404","scanFiles","dir","file","stats","ext","modelName","basename","on","helperName","emit","buildTest","interval","watchFile","curr","prev","mtime","resolve","unwatch","unwatchFile","depth","fn","_mem","count","called","readdir","err","files","i","last","iterate","name","stat","finish","isDirectory","isFile","extname","substr","encoding","lookup","charset","charsets","module","exports"],"sources":["/Users/ajithkumarr/node_modules/app/lib/App.js"],"sourcesContent":["/*global require module console*/\n(function(){\"use strict\";\n\tvar fs = require('fs'),\n\t    qs = require('querystring'),\n\t    url = require('url'),\n\t    sys = require('util'),\n\t    path = require('path'),\n\t    mime = require('mime'),\n\t    core = require('cornerstone'),\n\t    util = core.require('util'),\n\t    Model = require('./Model'),\n\t    Router = core.require('Router'),\n\t    Emitter = core.require('Emitter'),\n\t    connect = require('connect'),\n\t    mongoose = require('mongoose'),\n\t    Controller = require('./Controller');\n\tfunction App () {return this.initApp();}\n\tutil.inherits(App, Emitter);\n\tvar app = App.prototype;\n\tApp.check = function (obj) {\n\t\treturn Emitter.check(obj) && obj.initApp === App.prototype.initApp;\n\t};\n\tApp.create = function (obj, args) {\n\t\tobj = obj || {};\n\t\tif (!Emitter.check(obj)) Emitter.create(obj);\n\t\tobj.initApp = app.initApp || function () {\n\t\t\tthis.initEmitter();\n\t\t\tthis.options = Object.create(this.options);\n\t\t\tthis.helpers = {};\n\t\t\tthis.router = new Router();\n\t\t\tthis.cache = Object.create(this.cache);\n\t\t\tthis.model = {};\n\t\t\treturn this;\n\t\t};\n\t\tobj.options = {\n\t\t\tlog: true,\n\t\t\troot: null,\n\t\t\tport: 1337,\n\t\t\thost: '127.0.0.1',\n\t\t\tmaxAge: 86400000,\n\t\t\tdbhost: '127.0.0.1',\n\t\t\tdbport: '27017',\n\t\t\tdbname: 'test',\n\t\t\thotCode: true,\n\t\t\twatchInterval: 500,\n\t\t\tsessionSecret: 'nosecret',\n\t\t\trequestLimit: '50mb'\n\t\t};\n\t\tobj.cache = {};\n\t\t(function(){\n\t\t\tvar appClient = require('app-client'),\n\t\t\t    clientSrc = appClient(),\n\t\t\t    modified = new Date(),\n\t\t\t    utils = connect.utils;\n\t\t\tobj.cache['/app/client.js'] = function (req, res, next) {\n\t\t\t\tvar head = req.method === 'HEAD',\n\t\t\t\t    src = clientSrc;\n\t\t\t\tif (req.method !== 'GET' && !head) return next();\n\t\t\t\tres.setHeader('Content-Type', 'text/javascript; charset=UTF-8');\n\t\t\t\tres.setHeader('Content-Length', src.length);\n\t\t\t\tres.setHeader('Vary', 'Accept-Encoding');\n\t\t\t\tres.setHeader('Cache-Control', 'public, max-age=86400');\n\t\t\t\tres.setHeader('Last-Modified', modified.toUTCString());\n\t\t\t\tres.setHeader('ETag', '\"' + src.length + '-' + modified.getTime() + '\"');\n\t\t\t\tif (utils.conditionalGET(req) && !utils.modified(req, res)) {\n\t\t\t\t\tutils.notModified(res);\n\t\t\t\t}\n\t\t\t\telse if (head) res.end();\n\t\t\t\telse {\n\t\t\t\t\tres.writeHead(200);\n\t\t\t\t\tres.end(src, 'utf8');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t};\n\t\t})();\n\t\tobj.config = function (opts) {\n\t\t\tutil.assign(this.options, opts);\n\t\t\treturn this;\n\t\t};\n\t\tobj.setup = function () {\n\t\t\tvar log = this.options.log,\n\t\t\t    root = this.options.root,\n\t\t\t    maxAge = this.options.maxAge,\n\t\t\t    publc = path.join(root, 'public');\n\t\t\tthis.log('Setup application server.');\n\t\t\tthis.server = connect.createServer();\n\t\t\tif (log) this.server.\n\t\t\t\tuse(connect.profiler()).\n\t\t\t\tuse(connect.logger());\n\t\t\tthis.server.\n\t\t\t\tuse(connect.limit(this.options.requestLimit)).\n\t\t\t\tuse(connect.bodyParser()).\n\t\t\t\tuse(connect.cookieParser()).\n\t\t\t\tuse(connect.session({secret: this.options.sessionSecret})).\n\t\t\t\tuse(connect.favicon(path.join(publc, 'favicon.ico'))).\n\t\t\t\tuse(/*'/client', */connect['static'](path.join(root, 'client', {maxAge: maxAge}))).\n\t\t\t\tuse(this.onRequest()).\n\t\t\t\tuse(connect['static'](publc, {maxAge: maxAge})).\n\t\t\t\tuse(this.respond404());\n\t\t\tif (log) this.server.\n\t\t\t\tuse(connect.responseTime());\n\t\t\tthis.log('Application server ready.');\n\t\t\treturn this.forever('setup server');\n\t\t};\n\t\tobj.connectDB = function () {\n\t\t\tif (this.db) return this;\n\t\t\tthis.db = mongoose.connect(\n\t\t\t\tthis.options.dbhost,\n\t\t\t\tthis.options.dbname,\n\t\t\t\tthis.options.dbport\n\t\t\t);\n\t\t\treturn this;\n\t\t};\n\t\tobj.log = function () {\n\t\t\tif (this.options.log) console.log.apply(console, arguments);\n\t\t\treturn this;\n\t\t};\n\t\tobj.listen = function (cb) {\n\t\t\tvar that = this,\n\t\t\t    port = this.options.port,\n\t\t\t    host = this.options.host;\n\t\t\tthis.log('Building and caching http://' + host + ':' + port + '.');\n\t\t\treturn this.buildModel(function () {\n\t\t\t\tthat.buildApp(function () {\n\t\t\t\t\tthat.log('Listening http://' + host + ':' + port + '.');\n\t\t\t\t\tthat.server.listen(port, host, function () {\n\t\t\t\t\t\tthat.watchHotCode().buildClient(function () {\n\t\t\t\t\t\t\tthat.log('Finished http://' + host + ':' + port + '.');\n\t\t\t\t\t\t\tcb.call(that);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tobj.close = function () {\n\t\t\tthis.server.close();\n\t\t\tif (this.options.hotCode) {\n\t\t\t\tthis.unwatchHotCode();\n\t\t\t}\n\t\t\treturn this;\n\t\t};\n\t\tobj.routes = function (routes) {\n\t\t\tthis.router.def(routes);\n\t\t\treturn this;\n\t\t};\n\t\tobj.onRequest = function () {\n\t\t\tvar that = this;\n\t\t\treturn function (req, res, next) {\n\t\t\t\tvar uri = url.parse(req.url),\n\t\t\t\t    pth = uri.pathname,\n\t\t\t\t    route;\n\t\t\t\tif (that.cache[pth]) {\n\t\t\t\t\tthat.log('app cache - ' + pth);\n\t\t\t\t\tthat.cache[pth].call(that, req, res, next);\n\t\t\t\t} else {\n\t\t\t\t\troute = that.router.get(pth);\n\t\t\t\t\tif (route && route['']) {\n\t\t\t\t\t\tthat.log('app route - ' + pth);\n\t\t\t\t\t\tthat.router.send(route, function (r, info) {\n\t\t\t\t\t\t\treq.routeInfo = info;\n\t\t\t\t\t\t\treq.query = qs.parse(uri.query);\n\t\t\t\t\t\t\treq.app = res.app = that;\n\t\t\t\t\t\t\tr.call(that, req, res, next);\n\t\t\t\t\t\t}, that);\n\t\t\t\t\t} else next();\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\tobj.respond404 = function () {\n\t\t\tvar that = this;\n\t\t\treturn function (req, res, next) {\n\t\t\t\tif (util.isFunction(that.custom404)) {\n\t\t\t\t\tthat.custom404(req, res, next);\n\t\t\t\t} else {\n\t\t\t\t\tres.writeHead(404, {'Content-Type': 'text/plain'});\n\t\t\t\t\tres.end('404');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\tobj.buildModel = function (cb) {\n\t\t\tthis.log('Building models.');\n\t\t\tvar that = this;\n\t\t\treturn this.scanFiles(\n\t\t\t\tpath.join(this.options.root, 'model'), 1,\n\t\t\t\tfunction (dir, file, stats, end) {\n\t\t\t\t\tif (file && stats.ext === 'js') {\n\t\t\t\t\t\tvar modelName = path.basename(file, '.js');\n\t\t\t\t\t\tthat.model[modelName] = require(file)(that);\n\t\t\t\t\t}\n\t\t\t\t\tend();\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tthat.log('Finished building models.');\n\t\t\t\t\tthis.connectDB();\n\t\t\t\t\tcb.apply(this, arguments);\n\t\t\t\t\tthat.forever('setup models');\n\t\t\t\t}\n\t\t\t);\n\t\t};\n\t\tobj.buildApp = function (cb) {\n\t\t\tthis.log('Building app.');\n\t\t\tvar that = this;\n\t\t\tthis.on('setup models', function () {\n\t\t\t\t/*\n\t\t\t\tthat.io.sockets.on('connection', function (socket) {\n\t\t\t\t\tthat.socket = socket;\n\t\t\t\t\tthat.forever('socket ready', socket);\n\t\t\t\t});\n\t\t\t\t*/\n\t\t\t\tthat.scanFiles(\n\t\t\t\t\tpath.join(this.options.root, 'app'), 1,\n\t\t\t\t\tfunction (dir, file, stats, end) {\n\t\t\t\t\t\tif (file && stats.ext === 'js') {\n\t\t\t\t\t\t\tvar helperName = path.basename(file, '.js');\n\t\t\t\t\t\t\tthat.helpers[helperName] = require(file)(that);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tend();\n\t\t\t\t\t},\n\t\t\t\t\tfunction () {\n\t\t\t\t\t\tthat.log('Finished building app.');\n\t\t\t\t\t\tcb.apply(this, arguments);\n\t\t\t\t\t\tthat.emit('setup app');\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t\t\treturn this;\n\t\t};\n\t\tobj.buildClient = function (cb) {\n\t\t\tcb.call(this);\n\t\t\treturn this;\n\t\t};\n\t\tobj.buildTest = function (cb) {\n\t\t\tcb.call(this);\n\t\t\treturn this;\n\t\t};\n\t\tobj.watchHotCode = function () {\n\t\t\tif (!this.options.hotCode) return this;\n\t\t\tvar that = this,\n\t\t\t    opts = {interval: this.options.watchInterval};\n\t\t\tthis.log('Creating model hot code watchers.').scanFiles(\n\t\t\t\tpath.join(this.options.root, 'model'), 1,\n\t\t\t\tfunction (dir, file, stats, end) {\n\t\t\t\t\tif (file && stats.ext === 'js') {\n\t\t\t\t\t\tvar modelName = path.basename(file, '.js');\n\t\t\t\t\t\tfs.watchFile(file, opts, function (curr, prev) {\n\t\t\t\t\t\t\tif (curr.mtime > prev.mtime) {\n\t\t\t\t\t\t\t\tdelete require.cache[require.resolve(file)];\n\t\t\t\t\t\t\t\tthat.model[modelName] = require(file)(that);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tend();\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tthat.log('Finished creating model hot code watchers.');\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.log('Creating app hot code watchers.').scanFiles(\n\t\t\t\tpath.join(this.options.root, 'app'), 1,\n\t\t\t\tfunction (dir, file, stats, end) {\n\t\t\t\t\tif (file && stats.ext === 'js') {\n\t\t\t\t\t\tvar helperName = path.basename(file, '.js');\n\t\t\t\t\t\tfs.watchFile(file, opts, function (curr, prev) {\n\t\t\t\t\t\t\tif (curr.mtime > prev.mtime) {\n\t\t\t\t\t\t\t\tdelete require.cache[require.resolve(file)];\n\t\t\t\t\t\t\t\tthat.helpers[helperName] = require(file)(that);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tend();\n\t\t\t\t},\n\t\t\t\tfunction () {\n\t\t\t\t\tthat.log('Finished creating app hot code watchers.');\n\t\t\t\t}\n\t\t\t);\n\t\t\treturn this;\n\t\t};\n\t\tobj.unwatchHotCode = function (cb) {\n\t\t\tif (!this.options.hotCode) return this;\n\t\t\tvar that = this;\n\t\t\tfunction unwatch (dir, file, stats, end) {\n\t\t\t\tif (file && stats.ext === 'js') {\n\t\t\t\t\tfs.unwatchFile(file);\n\t\t\t\t}\n\t\t\t\tend();\n\t\t\t}\n\t\t\tthis.scanFiles(\n\t\t\t\tpath.join(this.options.root, 'model'), 1,\n\t\t\t\tunwatch,\n\t\t\t\tcb\n\t\t\t);\n\t\t\tthis.scanFiles(\n\t\t\t\tpath.join(this.options.root, 'app'), 1,\n\t\t\t\tunwatch,\n\t\t\t\tcb\n\t\t\t);\n\t\t\treturn this;\n\t\t};\n\t\tobj.scanFiles = function (dir, depth, fn, cb, _mem) {\n\t\t\tvar that = this;\n\t\t\tif (typeof fn !== 'function') return this;\n\t\t\tif (!_mem) _mem = {count: 1};\n\t\t\tif (!_mem.end) _mem.end = function end () {\n\t\t\t\t_mem.count -= 1;\n\t\t\t\tif (_mem.count <= 0 && !_mem.called) {\n\t\t\t\t\t_mem.called = true;\n\t\t\t\t\tcb.call(that);\n\t\t\t\t}\n\t\t\t};\n\t\t\tfs.readdir(dir, function  (err, files) {\n\t\t\t\tif (err) throw err;\n\t\t\t\tif (files.length === 0) {\n\t\t\t\t\treturn _mem.end();\n\t\t\t\t}\n\t\t\t\tvar i = 0,\n\t\t\t\t    end = files.length,\n\t\t\t\t    last = files[end - 1];\n\t\t\t\tfunction iterate (name) {\n\t\t\t\t\tvar file = path.join(dir, name);\n\t\t\t\t\tfs.stat(file, function (err, stats) {\n\t\t\t\t\t\tif (err) throw err;\n\t\t\t\t\t\tfunction finish () {\n\t\t\t\t\t\t\t_mem.end();\n\t\t\t\t\t\t\tif (name === last) {\n\t\t\t\t\t\t\t\t_mem.end();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (stats.isDirectory() && depth > 0) {\n\t\t\t\t\t\t\t_mem.count += 1;\n\t\t\t\t\t\t\tfn.call(that, file, null, stats, function () {\n\t\t\t\t\t\t\t\tthat.scanFiles(file, depth - 1, fn, null, _mem);\n\t\t\t\t\t\t\t\tif (name === last) {\n\t\t\t\t\t\t\t\t\t_mem.end();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (stats.isFile()) {\n\t\t\t\t\t\t\t_mem.count += 1;\n\t\t\t\t\t\t\tstats.ext = path.extname(file).substr(1);\n\t\t\t\t\t\t\tstats.encoding = mime.lookup(file);\n\t\t\t\t\t\t\tstats.charset = mime.charsets.lookup(stats.encoding);\n\t\t\t\t\t\t\tfn.call(that, dir, file, stats, finish);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfinish();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tfor (; i < end; i += 1) iterate(files[i]);\n\t\t\t\treturn null;\n\t\t\t});\n\t\t\treturn this;\n\t\t};\n\t\tif (args) obj.initApp.apply(obj, args);\n\t\treturn obj;\n\t};\n\t(module.exports = App).create(App.prototype);\n}).call(this);"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
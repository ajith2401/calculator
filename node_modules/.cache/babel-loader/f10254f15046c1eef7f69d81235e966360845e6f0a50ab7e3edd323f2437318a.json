{"ast":null,"code":"/*global module require console*/\n(function () {\n  \"use strict\";\n\n  var core = require('cornerstone'),\n    util = core.require('./util'),\n    Class = core.require('./Class'),\n    Emitter = core.require('./Emitter'),\n    mongoose = require('mongoose');\n  module.exports = Class.create('Model', Emitter, function (obj, supr, proto) {\n    obj.initModel = function (name) {\n      this.name = name;\n      return this.initEmitter();\n    };\n    obj.install = function (module, factory) {\n      var that = this;\n      module.exports = function (app) {\n        that.app = app;\n        that.schema = util.safeApply(factory, that) || that.schema;\n        that.model = mongoose.model(that.name, that.schema);\n        return that.forever('installed');\n      };\n      this.install = function () {\n        return this;\n      };\n      return this;\n    };\n    obj.mongoose = mongoose;\n    obj.Schema = mongoose.Schema;\n    obj.ObjId = obj.Schema.ObjectId;\n    obj.getById = function (id, cb) {\n      return this.on('installed', function () {\n        var that = this;\n        this.model.findById(id, function (err, user) {\n          cb.call(that, err, user);\n        });\n      });\n    };\n    obj.find = function (username, cb) {\n      return this.on('installed', function () {\n        var that = this;\n        this.model.findOne({\n          username: username\n        }, function (err, user) {\n          cb.call(that, err, user);\n        });\n      });\n    };\n    obj.list = function (params, cb) {\n      return this.on('installed', function () {\n        var that = this;\n        this.model.find(params, function (err, users) {\n          cb.call(that, err, users);\n        });\n      });\n    };\n    obj.read = function (data, cb) {\n      return this.getById(data._id, function (err, user) {\n        cb.call(this, err, user);\n      });\n    };\n    obj.save = function (data, cb) {\n      if (!data._id) {\n        return this.on('installed', function () {\n          var that = this,\n            user = new this.model(data);\n          user.save(function (err) {\n            cb.call(that, err, err ? null : user);\n          });\n        });\n      }\n      return this.getById(data._id, function (err, user) {\n        if (err) {\n          cb.call(this, err);\n        } else {\n          if (!user) {\n            user = new this.model(data);\n          }\n          var that = this;\n          user.save(function (err) {\n            cb.call(that, err, user);\n          });\n        }\n      });\n    };\n    obj.destroy = function (data, cb) {\n      return this.getById(data._id, function (err, user) {\n        if (!err && user) {\n          var that = this;\n          user.remove(function (err) {\n            cb.call(that, err, user);\n          });\n        } else {\n          cb.call(this);\n        }\n      });\n    };\n  });\n}).call(this);","map":{"version":3,"names":["core","require","util","Class","Emitter","mongoose","module","exports","create","obj","supr","proto","initModel","name","initEmitter","install","factory","that","app","schema","safeApply","model","forever","Schema","ObjId","ObjectId","getById","id","cb","on","findById","err","user","call","find","username","findOne","list","params","users","read","data","_id","save","destroy","remove"],"sources":["/Users/ajithkumarr/node_modules/app/lib/Model.js"],"sourcesContent":["/*global module require console*/\n(function(){\"use strict\";\n\tvar core = require('cornerstone'),\n\t    util = core.require('./util'),\n\t    Class = core.require('./Class'),\n\t    Emitter = core.require('./Emitter'),\n\t    mongoose = require('mongoose');\n\tmodule.exports = Class.create('Model', Emitter, function (obj, supr, proto) {\n\t\tobj.initModel = function (name) {\n\t\t\tthis.name = name;\n\t\t\treturn this.initEmitter();\n\t\t};\n\t\tobj.install = function (module, factory) {\n\t\t\tvar that = this;\n\t\t\tmodule.exports = function (app) {\n\t\t\t\tthat.app = app;\n\t\t\t\tthat.schema = util.safeApply(factory, that) || that.schema;\n\t\t\t\tthat.model = mongoose.model(that.name, that.schema);\n\t\t\t\treturn that.forever('installed');\n\t\t\t};\n\t\t\tthis.install = function () {\n\t\t\t\treturn this;\n\t\t\t};\n\t\t\treturn this;\n\t\t};\n\t\tobj.mongoose = mongoose;\n\t\tobj.Schema = mongoose.Schema;\n\t\tobj.ObjId = obj.Schema.ObjectId;\n\t\tobj.getById = function (id, cb) {\n\t\t\treturn this.on('installed', function () {\n\t\t\t\tvar that = this;\n\t\t\t\tthis.model.findById(id, function (err, user) {\n\t\t\t\t\tcb.call(that, err, user);\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tobj.find = function (username, cb) {\n\t\t\treturn this.on('installed', function () {\n\t\t\t\tvar that = this;\n\t\t\t\tthis.model.findOne({username: username}, function (err, user) {\n\t\t\t\t\tcb.call(that, err, user);\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tobj.list = function (params, cb) {\n\t\t\treturn this.on('installed', function () {\n\t\t\t\tvar that = this;\n\t\t\t\tthis.model.find(params, function (err, users) {\n\t\t\t\t\tcb.call(that, err, users);\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tobj.read = function (data, cb) {\n\t\t\treturn this.getById(data._id, function (err, user) {\n\t\t\t\tcb.call(this, err, user);\n\t\t\t});\n\t\t};\n\t\tobj.save = function (data, cb) {\n\t\t\tif (!data._id) {\n\t\t\t\treturn this.on('installed', function () {\n\t\t\t\t\tvar that = this,\n\t\t\t\t\t    user = new this.model(data);\n\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\tcb.call(that, err, err ? null : user);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn this.getById(data._id, function (err, user) {\n\t\t\t\tif (err) {\n\t\t\t\t\tcb.call(this, err);\n\t\t\t\t} else {\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tuser = new this.model(data);\n\t\t\t\t\t}\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\tcb.call(that, err, user);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\tobj.destroy = function (data, cb) {\n\t\t\treturn this.getById(data._id, function (err, user) {\n\t\t\t\tif (!err && user) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\tuser.remove(function (err) {\n\t\t\t\t\t\tcb.call(that, err, user);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tcb.call(this);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t});\n}).call(this);"],"mappings":"AAAA;AACA,CAAC,YAAU;EAAC,YAAY;;EACvB,IAAIA,IAAI,GAAGC,OAAO,CAAC,aAAa,CAAC;IAC7BC,IAAI,GAAGF,IAAI,CAACC,OAAO,CAAC,QAAQ,CAAC;IAC7BE,KAAK,GAAGH,IAAI,CAACC,OAAO,CAAC,SAAS,CAAC;IAC/BG,OAAO,GAAGJ,IAAI,CAACC,OAAO,CAAC,WAAW,CAAC;IACnCI,QAAQ,GAAGJ,OAAO,CAAC,UAAU,CAAC;EAClCK,MAAM,CAACC,OAAO,GAAGJ,KAAK,CAACK,MAAM,CAAC,OAAO,EAAEJ,OAAO,EAAE,UAAUK,GAAG,EAAEC,IAAI,EAAEC,KAAK,EAAE;IAC3EF,GAAG,CAACG,SAAS,GAAG,UAAUC,IAAI,EAAE;MAC/B,IAAI,CAACA,IAAI,GAAGA,IAAI;MAChB,OAAO,IAAI,CAACC,WAAW,EAAE;IAC1B,CAAC;IACDL,GAAG,CAACM,OAAO,GAAG,UAAUT,MAAM,EAAEU,OAAO,EAAE;MACxC,IAAIC,IAAI,GAAG,IAAI;MACfX,MAAM,CAACC,OAAO,GAAG,UAAUW,GAAG,EAAE;QAC/BD,IAAI,CAACC,GAAG,GAAGA,GAAG;QACdD,IAAI,CAACE,MAAM,GAAGjB,IAAI,CAACkB,SAAS,CAACJ,OAAO,EAAEC,IAAI,CAAC,IAAIA,IAAI,CAACE,MAAM;QAC1DF,IAAI,CAACI,KAAK,GAAGhB,QAAQ,CAACgB,KAAK,CAACJ,IAAI,CAACJ,IAAI,EAAEI,IAAI,CAACE,MAAM,CAAC;QACnD,OAAOF,IAAI,CAACK,OAAO,CAAC,WAAW,CAAC;MACjC,CAAC;MACD,IAAI,CAACP,OAAO,GAAG,YAAY;QAC1B,OAAO,IAAI;MACZ,CAAC;MACD,OAAO,IAAI;IACZ,CAAC;IACDN,GAAG,CAACJ,QAAQ,GAAGA,QAAQ;IACvBI,GAAG,CAACc,MAAM,GAAGlB,QAAQ,CAACkB,MAAM;IAC5Bd,GAAG,CAACe,KAAK,GAAGf,GAAG,CAACc,MAAM,CAACE,QAAQ;IAC/BhB,GAAG,CAACiB,OAAO,GAAG,UAAUC,EAAE,EAAEC,EAAE,EAAE;MAC/B,OAAO,IAAI,CAACC,EAAE,CAAC,WAAW,EAAE,YAAY;QACvC,IAAIZ,IAAI,GAAG,IAAI;QACf,IAAI,CAACI,KAAK,CAACS,QAAQ,CAACH,EAAE,EAAE,UAAUI,GAAG,EAAEC,IAAI,EAAE;UAC5CJ,EAAE,CAACK,IAAI,CAAChB,IAAI,EAAEc,GAAG,EAAEC,IAAI,CAAC;QACzB,CAAC,CAAC;MACH,CAAC,CAAC;IACH,CAAC;IACDvB,GAAG,CAACyB,IAAI,GAAG,UAAUC,QAAQ,EAAEP,EAAE,EAAE;MAClC,OAAO,IAAI,CAACC,EAAE,CAAC,WAAW,EAAE,YAAY;QACvC,IAAIZ,IAAI,GAAG,IAAI;QACf,IAAI,CAACI,KAAK,CAACe,OAAO,CAAC;UAACD,QAAQ,EAAEA;QAAQ,CAAC,EAAE,UAAUJ,GAAG,EAAEC,IAAI,EAAE;UAC7DJ,EAAE,CAACK,IAAI,CAAChB,IAAI,EAAEc,GAAG,EAAEC,IAAI,CAAC;QACzB,CAAC,CAAC;MACH,CAAC,CAAC;IACH,CAAC;IACDvB,GAAG,CAAC4B,IAAI,GAAG,UAAUC,MAAM,EAAEV,EAAE,EAAE;MAChC,OAAO,IAAI,CAACC,EAAE,CAAC,WAAW,EAAE,YAAY;QACvC,IAAIZ,IAAI,GAAG,IAAI;QACf,IAAI,CAACI,KAAK,CAACa,IAAI,CAACI,MAAM,EAAE,UAAUP,GAAG,EAAEQ,KAAK,EAAE;UAC7CX,EAAE,CAACK,IAAI,CAAChB,IAAI,EAAEc,GAAG,EAAEQ,KAAK,CAAC;QAC1B,CAAC,CAAC;MACH,CAAC,CAAC;IACH,CAAC;IACD9B,GAAG,CAAC+B,IAAI,GAAG,UAAUC,IAAI,EAAEb,EAAE,EAAE;MAC9B,OAAO,IAAI,CAACF,OAAO,CAACe,IAAI,CAACC,GAAG,EAAE,UAAUX,GAAG,EAAEC,IAAI,EAAE;QAClDJ,EAAE,CAACK,IAAI,CAAC,IAAI,EAAEF,GAAG,EAAEC,IAAI,CAAC;MACzB,CAAC,CAAC;IACH,CAAC;IACDvB,GAAG,CAACkC,IAAI,GAAG,UAAUF,IAAI,EAAEb,EAAE,EAAE;MAC9B,IAAI,CAACa,IAAI,CAACC,GAAG,EAAE;QACd,OAAO,IAAI,CAACb,EAAE,CAAC,WAAW,EAAE,YAAY;UACvC,IAAIZ,IAAI,GAAG,IAAI;YACXe,IAAI,GAAG,IAAI,IAAI,CAACX,KAAK,CAACoB,IAAI,CAAC;UAC/BT,IAAI,CAACW,IAAI,CAAC,UAAUZ,GAAG,EAAE;YACxBH,EAAE,CAACK,IAAI,CAAChB,IAAI,EAAEc,GAAG,EAAEA,GAAG,GAAG,IAAI,GAAGC,IAAI,CAAC;UACtC,CAAC,CAAC;QACH,CAAC,CAAC;MACH;MACA,OAAO,IAAI,CAACN,OAAO,CAACe,IAAI,CAACC,GAAG,EAAE,UAAUX,GAAG,EAAEC,IAAI,EAAE;QAClD,IAAID,GAAG,EAAE;UACRH,EAAE,CAACK,IAAI,CAAC,IAAI,EAAEF,GAAG,CAAC;QACnB,CAAC,MAAM;UACN,IAAI,CAACC,IAAI,EAAE;YACVA,IAAI,GAAG,IAAI,IAAI,CAACX,KAAK,CAACoB,IAAI,CAAC;UAC5B;UACA,IAAIxB,IAAI,GAAG,IAAI;UACfe,IAAI,CAACW,IAAI,CAAC,UAAUZ,GAAG,EAAE;YACxBH,EAAE,CAACK,IAAI,CAAChB,IAAI,EAAEc,GAAG,EAAEC,IAAI,CAAC;UACzB,CAAC,CAAC;QACH;MACD,CAAC,CAAC;IACH,CAAC;IACDvB,GAAG,CAACmC,OAAO,GAAG,UAAUH,IAAI,EAAEb,EAAE,EAAE;MACjC,OAAO,IAAI,CAACF,OAAO,CAACe,IAAI,CAACC,GAAG,EAAE,UAAUX,GAAG,EAAEC,IAAI,EAAE;QAClD,IAAI,CAACD,GAAG,IAAIC,IAAI,EAAE;UACjB,IAAIf,IAAI,GAAG,IAAI;UACfe,IAAI,CAACa,MAAM,CAAC,UAAUd,GAAG,EAAE;YAC1BH,EAAE,CAACK,IAAI,CAAChB,IAAI,EAAEc,GAAG,EAAEC,IAAI,CAAC;UACzB,CAAC,CAAC;QACH,CAAC,MAAM;UACNJ,EAAE,CAACK,IAAI,CAAC,IAAI,CAAC;QACd;MACD,CAAC,CAAC;IACH,CAAC;EACF,CAAC,CAAC;AACH,CAAC,EAAEA,IAAI,CAAC,IAAI,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}